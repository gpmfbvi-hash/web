<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="utf-8">
  <title>GPMF 관리자 - 토큰 관리 대시보드</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="GPMF Gold Token 관리 도구 – BSC 메인넷 지원">
  <!-- 라이브러리 -->
  <script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js/dist/web3.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

  <!-- 프로젝트 파일 -->
  <link rel="stylesheet" href="styles.css">
  <script defer type="text/javascript" src="smartcontract.js"></script>
  <script defer type="text/javascript" src="index.js"></script>
</head>

<body>
  <div class="container">
    <!-- 헤더/네비 -->
    <header class="main-header" style="display:flex;justify-content:space-between;align-items:center;gap:12px;">
      <div>
        <h1>🪙 GPMF Gold Token<br> 관리자 대시보드</h1>
        <p class="subtitle">GPMF ERC20 토큰을 쉽고 안전하게 관리하세요 (BSC Mainnet)</p>
      </div>
      <nav>
        <a class="btn-secondary" href="./guide.html" target="_blank"
          style="text-decoration:none;display:inline-block;padding:10px 14px;border-radius:8px;">📖 사용 가이드</a>
      </nav>
    </header>

    <!-- 네트워크/지갑 -->
    <section class="wallet-section">
      <div class="wallet-connection" style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;">
        <button class="btn-connect-wallet" onclick="connectWallet()">🔗 지갑 연결 (Trust Wallet / MetaMask)</button>
        <label for="networkSelect" style="font-weight:600;">네트워크:</label>
        <select id="networkSelect" class="form-input" style="max-width:220px;">
          <option value="56">BSC Mainnet</option>
        </select>
      </div>
      <div class="connection-help">
        <small>💡 Trust Wallet 또는 MetaMask가 없다면 <a href="https://trustwallet.com" target="_blank">설치</a>하세요.</small>
      </div>

      <div class="wallet-info">
        <div class="info-grid">
          <div class="info-item">
            <span class="info-label">🏠 지갑 주소:</span>
            <span id="walletAddress" class="info-value">연결되지 않음</span>
          </div>
          <div class="info-item">
            <span class="info-label">💰 BNB 잔고:</span>
            <span id="walletBalance" class="info-value">-</span>
          </div>
          <div class="info-item">
            <span class="info-label">🪙 GPMF 보유:</span>
            <span id="tokenBalance" class="info-value">-</span>
          </div>
          <div class="info-item">
            <span class="info-label">🔑 권한 레벨:</span>
            <span id="walletRole" class="wallet-role">연결되지 않음</span>
          </div>
        </div>
      </div>
    </section>

    <!-- BscScan 바로가기 -->
    <section class="category">
      <h2 onclick="toggleCategory(this)" class="category-header">
        🔍 BscScan 바로가기
        <span class="toggle-icon">&#9662;</span>
        <span class="category-desc">컨트랙트/토큰 트래커/홀더 보기</span>
      </h2>
      <div class="category-content">
        <div class="bscscan-links">
          <a href="" id="bscscanContract" target="_blank" class="btn-external">📄 컨트랙트 페이지</a>
          <a href="" id="bscscanTokenTracker" target="_blank" class="btn-external">🪙 토큰 트래커</a>
          <a href="" id="bscscanHoldAddress" target="_blank" class="btn-external">📊 홀더 랭킹</a>
        </div>
        <p class="note">📌 네트워크 선택(상단) 및 지갑 연결 후 정확한 링크가 생성됩니다.</p>
      </div>
    </section>

    <!-- 컨트랙트 상태 -->
    <section class="category">
      <h2 onclick="toggleCategory(this)" class="category-header">
        🧭 컨트랙트 상태
        <span class="toggle-icon">&#9662;</span>
        <span class="category-desc">현재 토큰 정보와 상태를 한눈에 확인</span>
      </h2>
      <div class="category-content">
        <div class="form-group">
          <button class="btn-secondary" onclick="loadContractState()">🔄 상태 새로고침</button>
        </div>
        <div class="info-grid">
          <div class="info-item"><span class="info-label">📛 토큰명:</span> <span id="st_name" class="info-value">-</span></div>
          <div class="info-item"><span class="info-label">🔤 심볼:</span> <span id="st_symbol" class="info-value">-</span></div>
          <div class="info-item"><span class="info-label">🔢 소수점:</span> <span id="st_decimals" class="info-value">-</span></div>
          <div class="info-item"><span class="info-label">📊 총 발행량:</span> <span id="st_totalSupply" class="info-value">-</span></div>
          <div class="info-item"><span class="info-label">⏸ 일시정지:</span> <span id="st_paused" class="info-value">-</span></div>
          <div class="info-item" style="grid-column: 1 / -1;">
            <span class="info-label">👑 Owner:</span>
            <span id="st_owner" class="info-value mono" style="word-break:break-all;">-</span>
          </div>
        </div>

        <div class="form-group" style="margin-top:12px;">
          <label class="form-label">⚡ 빠른 제어 <span class="required-badge">OWNER</span></label>
          <div class="input-group" style="display:flex;gap:8px;flex-wrap:wrap;">
            <button class="btn-warning owner-only" onclick="pauseToken()">⏸ 일시정지</button>
            <button class="btn-secondary owner-only" onclick="unpauseToken()">▶ 정상화</button>
          </div>
          <small class="note">토큰 전송을 일시적으로 중지하거나 재개할 수 있습니다.</small>
        </div>
      </div>
    </section>

    <!-- Lockup 관리 -->
    <section class="category">
      <h2 onclick="toggleCategory(this)" class="category-header">
        🔒 Lockup 관리
        <span class="toggle-icon">&#9662;</span>
        <span class="category-desc">토큰 락업 설정/연장/감소/해제</span>
      </h2>
      <div class="category-content">
        <div class="lockup-warning" style="background:rgba(255,107,107,0.1);border-left:4px solid #ff6b6b;padding:15px;border-radius:6px;margin-bottom:20px;">
          <h3 style="color:#ff6b6b;margin-top:0;">⚠️ 중요: 락업 설정 방식</h3>
          <p style="margin:10px 0;"><strong>락업은 "덮어쓰기" 방식입니다!</strong></p>
          <ul style="margin:10px 0;padding-left:20px;">
            <li>기존 락업: <strong>1000 GPMF</strong></li>
            <li>새로 설정: <strong>100 GPMF</strong> → 최종 결과: <strong>100 GPMF</strong> (❌ 1100 아님!)</li>
            <li>즉, setLockup()은 기존 락업을 완전히 새로운 값으로 <strong>교체</strong>합니다</li>
          </ul>
          <p style="margin:10px 0;color:#b8b8b8;">💡 수량을 늘리려면: 기존 수량 + 추가 수량을 계산하여 설정하세요 (예: 1000 → 1100으로 변경)</p>
        </div>

        <p class="note">⚠ Owner만 락업을 관리할 수 있습니다. 락업된 토큰은 기간 동안 전송이 불가능합니다.</p>
        
        <!-- 락업 설정 -->
        <div class="form-group">
          <label class="form-label">🆕 새 락업 설정 (덮어쓰기) <span class="required-badge">OWNER</span></label>
          <p class="function-desc">특정 주소의 토큰을 일정 기간 동안 잠급니다. <strong style="color:#ff6b6b;">기존 락업이 있다면 완전히 새로운 값으로 교체됩니다.</strong> 해당 주소는 락업 기간 동안 잠긴 수량만큼 전송할 수 없습니다. 락업 기간이 지나도 자동으로 해제되지 않으므로, 만료 후 "만료된 락업 제거"를 실행하거나 새로운 락업으로 덮어씌워야 합니다.</p>
          <input type="text" id="lockupAccount" placeholder="락업할 주소 (0x...)" class="form-input">
          <input type="number" id="lockupMinutes" placeholder="락업 시간 (분, 정수만)" class="form-input" min="1" step="1">
          <input type="number" id="lockupAmount" placeholder="락업 수량 (GPMF, 소수점 가능)" class="form-input" min="0" step="any">
          <button class="btn-primary owner-only" onclick="setLockup()">락업 설정</button>
          <small class="note">💡 예시: 100.5 GPMF를 1440분(1일) 동안 락업. 기존 락업은 완전히 삭제되고 새 값으로 설정됩니다.</small>
        </div>

        <!-- 락업 연장 -->
        <div class="form-group">
          <label class="form-label">⏱ 락업 기간 연장 <span class="required-badge">OWNER</span></label>
          <p class="function-desc">기존 락업의 만료 시간을 연장합니다. <strong>수량은 변경되지 않고 시간만 추가됩니다.</strong> 이미 락업이 설정된 주소에만 사용 가능하며, 락업이 없는 주소에는 사용할 수 없습니다. 예를 들어 현재 1일 남은 락업을 2일 더 연장하면 총 3일이 됩니다.</p>
          <input type="text" id="extendAccount" placeholder="주소 (0x...)" class="form-input">
          <input type="number" id="extendMinutes" placeholder="추가 시간 (분, 정수만)" class="form-input" min="1" step="1">
          <button class="btn-primary owner-only" onclick="extendLockup()">락업 연장</button>
          <small class="note">💡 예시: 기존 락업에 720분(12시간) 추가. 수량은 그대로 유지되고 기간만 늘어납니다.</small>
        </div>

        <!-- 락업 수량 감소 -->
        <div class="form-group">
          <label class="form-label">📉 락업 수량 감소 (새 수량으로 설정) <span class="required-badge">OWNER</span></label>
          <p class="function-desc">락업된 수량을 새로운 값으로 변경합니다. <strong style="color:#ff6b6b;">현재 수량보다 작은 값만 입력 가능하며, 기존 수량에서 빼는 것이 아니라 새로운 수량으로 교체됩니다.</strong> 0을 입력하면 락업이 완전히 해제됩니다. 락업 기간은 변경되지 않습니다. 예: 현재 1000 GPMF 락업 → 700 입력 → 최종 700 GPMF 락업 (300이 아님!)</p>
          <input type="text" id="decreaseAccount" placeholder="주소 (0x...)" class="form-input">
          <input type="number" id="decreaseAmount" placeholder="새로운 수량 (GPMF, 0이면 전체 해제)" class="form-input" min="0" step="any">
          <button class="btn-primary owner-only" onclick="decreaseLockAmount()">수량 감소</button>
          <small class="note">💡 예시: 기존 1000 GPMF → 750.5 입력 → 최종 750.5 GPMF 락업 (기존 값에서 750.5를 빼는 것이 아님!)</small>
        </div>

        <!-- 락업 부분 해제 -->
        <div class="form-group">
          <label class="form-label">🔓 락업 부분 해제 (차감 방식) <span class="required-badge">OWNER</span></label>
          <p class="function-desc">락업된 수량 중 일부만 즉시 해제합니다. <strong>입력한 수량만큼 기존 락업에서 차감됩니다.</strong> 락업 기간은 변경되지 않습니다. 전체 락업량보다 많은 수량은 입력할 수 없습니다. 예: 현재 1000 GPMF 락업 → 300 해제 → 최종 700 GPMF 락업 유지. 긴급하게 일부 토큰만 풀어야 할 때 사용합니다.</p>
          <input type="text" id="releaseAccount" placeholder="주소 (0x...)" class="form-input">
          <input type="number" id="releaseAmount" placeholder="해제할 수량 (GPMF)" class="form-input" min="0" step="any">
          <button class="btn-primary owner-only" onclick="releaseLockup()">부분 해제</button>
          <small class="note">💡 예시: 락업 1000 GPMF 중 250.75 GPMF만 즉시 해제 → 남은 락업 749.25 GPMF</small>
        </div>

        <!-- 만료된 락업 제거 -->
        <div class="form-group">
          <label class="form-label">🗑 만료된 락업 정보 제거 (선택사항) <span class="required-badge">OWNER</span></label>
          <p class="function-desc">기간이 만료된 락업 정보를 컨트랙트에서 깔끔하게 삭제합니다. <strong>만료된 락업은 자동으로 효력이 없어지므로 이 작업은 필수가 아닙니다.</strong> 단지 컨트랙트의 저장 공간을 정리하고 조회 시 깔끔하게 보이도록 하는 용도입니다. 만료되지 않은 락업에는 사용할 수 없으며, 에러가 발생합니다.</p>
          <input type="text" id="clearAccount" placeholder="만료된 락업 주소 (0x...)" class="form-input">
          <button class="btn-warning owner-only" onclick="clearExpiredLockup()">만료 락업 제거</button>
          <small class="note">💡 락업 기간이 지난 주소 입력 시 저장소에서 제거하여 깔끔하게 정리. 필수 작업은 아니며 가스비 절약용입니다.</small>
        </div>
      </div>
    </section>

    <!-- Lockup 조회 -->
    <section class="category">
      <h2 onclick="toggleCategory(this)" class="category-header">
        🔍 Lockup 조회
        <span class="toggle-icon">&#9662;</span>
        <span class="category-desc">락업 정보 및 사용 가능 잔액 확인</span>
      </h2>
      <div class="category-content">
        <p class="note">누구나 조회 가능합니다. 가스비가 들지 않는 읽기 전용 함수입니다.</p>
        
        <!-- 락업 정보 조회 -->
        <div class="form-group">
          <label class="form-label">🔎 락업 정보 확인 (무료 조회)</label>
          <p class="function-desc">특정 주소의 상세 락업 정보를 조회합니다. 현재 잠긴 수량, 남은 시간(초 단위), 정확한 만료 시각을 확인할 수 있습니다. 락업이 없거나 이미 만료된 경우 잠긴 수량이 0으로 표시됩니다. 가스비가 들지 않으므로 언제든 자유롭게 확인 가능합니다.</p>
          <div class="input-group" style="display:flex;gap:8px;flex-wrap:wrap;">
            <input type="text" id="checkLockupAccount" placeholder="조회할 주소 (0x...)" class="form-input" style="flex:1;">
            <button class="btn-secondary" onclick="checkLockupInfo()">조회</button>
          </div>
          <div id="lockupInfoResult" class="result-display"></div>
          <small class="note">💡 락업 수량, 남은 시간, 만료 일시를 한 번에 확인할 수 있습니다.</small>
        </div>

        <!-- 사용 가능 잔액 조회 -->
        <div class="form-group">
          <label class="form-label">✅ 사용 가능 잔액 확인 (무료 조회)</label>
          <p class="function-desc">특정 주소의 전체 잔액 중 실제로 전송 가능한 수량을 조회합니다. <strong>전체 잔액 - 락업 수량 = 사용 가능 잔액</strong>입니다. 예를 들어 전체 1000 GPMF 보유 중 300 GPMF가 락업되어 있다면, 700 GPMF만 전송 가능합니다. 토큰 전송 전 반드시 확인하세요.</p>
          <div class="input-group" style="display:flex;gap:8px;flex-wrap:wrap;">
            <input type="text" id="checkUnlockedAccount" placeholder="조회할 주소 (0x...)" class="form-input" style="flex:1;">
            <button class="btn-secondary" onclick="checkUnlockedBalance()">조회</button>
          </div>
          <div id="unlockedBalanceResult" class="result-display"></div>
          <small class="note">💡 전송하기 전 사용 가능한 잔액을 미리 확인하여 에러를 방지하세요.</small>
        </div>
      </div>
    </section>

    <!-- 토큰 전송 -->
    <section class="category">
      <h2 onclick="toggleCategory(this)" class="category-header">
        ✈️ 토큰 전송
        <span class="toggle-icon">&#9662;</span>
        <span class="category-desc">GPMF 토큰 전송</span>
      </h2>
      <div class="category-content">
        <p class="note">자신의 토큰을 다른 주소로 전송합니다. 락업된 토큰은 전송할 수 없습니다.</p>
        <div class="form-group">
          <label class="form-label">💸 토큰 전송</label>
          <p class="function-desc">보유한 GPMF 토큰을 다른 주소로 전송합니다. <strong>락업된 수량은 전송할 수 없으며, 사용 가능한 잔액 내에서만 전송 가능합니다.</strong> 전송 전 "사용 가능 잔액 확인"으로 전송 가능 수량을 먼저 확인하세요. 전송은 되돌릴 수 없으므로 받는 주소를 반드시 재확인하세요. 컨트랙트가 일시정지 상태면 전송이 불가능합니다.</p>
          <input type="text" id="transferTo" placeholder="받는 주소 (0x...)" class="form-input">
          <input type="number" id="transferAmount" placeholder="전송 수량 (GPMF, 소수점 가능)" class="form-input" min="0" step="any">
          <button class="btn-primary" onclick="transferToken()">전송</button>
          <small class="note">💡 예시: 123.456 GPMF 전송 가능. 락업 중인 토큰은 전송 불가합니다.</small>
        </div>
      </div>
    </section>

    <!-- 토큰 소각 -->
    <section class="category">
      <h2 onclick="toggleCategory(this)" class="category-header">
        🔥 토큰 소각
        <span class="toggle-icon">&#9662;</span>
        <span class="category-desc">보유한 GPMF 토큰 소각</span>
      </h2>
      <div class="category-content">
        <p class="note">자신의 토큰을 영구적으로 소각합니다. 이 작업은 되돌릴 수 없습니다.</p>
        <div class="form-group">
          <label class="form-label">🔥 토큰 소각 (영구 삭제)</label>
          <p class="function-desc">보유한 GPMF 토큰을 영구적으로 제거합니다. <strong style="color:#ff6b6b;">소각된 토큰은 절대 복구할 수 없으며, 총 공급량도 함께 감소합니다.</strong> 락업되지 않은 토큰만 소각 가능합니다. 디플레이션 효과를 위해 사용하거나, 실수로 받은 토큰을 제거할 때 사용합니다. 매우 신중하게 사용하세요.</p>
          <input type="number" id="burnAmount" placeholder="소각 수량 (GPMF, 소수점 가능)" class="form-input" min="0" step="any">
          <button class="btn-danger" onclick="burnToken()">소각 (복구 불가)</button>
          <small class="note">⚠️ 소각된 토큰은 영구적으로 사라지며 총 공급량이 감소합니다 (예: 99.99 GPMF)</small>
        </div>
      </div>
    </section>

    <!-- 토큰 정보 조회 -->
    <section class="category">
      <h2 onclick="toggleCategory(this)" class="category-header">
        📊 토큰 정보 조회
        <span class="toggle-icon">&#9662;</span>
        <span class="category-desc">주소별 토큰 잔액 확인</span>
      </h2>
      <div class="category-content">
        <p class="note">컨트랙트에서 제공하는 읽기 함수만 사용합니다. 가스가 들지 않습니다.</p>
        
        <!-- 잔액 조회 -->
        <div class="form-group">
          <label class="form-label">💰 토큰 잔액 조회 (무료)</label>
          <p class="function-desc">특정 주소의 전체 GPMF 보유량을 조회합니다. <strong>락업 여부와 관계없이 총 보유 수량을 표시합니다.</strong> 실제 사용 가능한 수량은 "사용 가능 잔액 확인"에서 별도로 조회하세요. 가스비가 들지 않으므로 언제든 자유롭게 조회할 수 있습니다.</p>
          <div class="input-group" style="display:flex;gap:8px;flex-wrap:wrap;">
            <input type="text" id="checkBalanceAccount" placeholder="조회할 주소 (0x...)" class="form-input" style="flex:1;">
            <button class="btn-secondary" onclick="checkBalance()">조회</button>
          </div>
          <div id="balanceResult" class="result-display"></div>
          <small class="note">💡 전체 잔액을 확인합니다. 이 중 일부는 락업되어 있을 수 있습니다.</small>
        </div>
      </div>
    </section>

    <footer style="margin-top:32px;text-align:center;opacity:0.8;">
      <small>© GPMF Gold Token Admin • ERC20 Token Dashboard (BSC Mainnet)</small>
    </footer>
  </div>

  <script>
    // 카테고리 토글
    function toggleCategory(el) {
      const content = el.parentElement.querySelector('.category-content');
      const icon = el.querySelector('.toggle-icon');
      if (content.style.display === 'block') {
        content.style.display = 'none';
        icon.innerHTML = '&#9662;';
      } else {
        content.style.display = 'block';
        icon.innerHTML = '&#9652;';
      }
    }
  </script>
</body>

</html>